#!/usr/bin/env bash

set -e

export SPRING_DATASOURCE_URL="${MICRO_IDENTITY_DB_URL}"
export SPRING_DATASOURCE_USERNAME="${MICRO_IDENTITY_DB_USERNAME}"
export SPRING_DATASOURCE_PASSWORD="${MICRO_IDENTITY_DB_PASSWORD}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_KEYSTORE_LOCATION="${MICRO_IDENTITY_EJBCA_KEYSTORE_LOCATION}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_KEYSTORE_PASSWORD="${MICRO_IDENTITY_EJBCA_KEYSTORE_PASSWORD}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_KEYSTORE_TYPE="${MICRO_IDENTITY_EJBCA_KEYSTORE_TYPE}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_TRUSTSTORE_LOCATION="${MICRO_IDENTITY_EJBCA_TRUSTSTORE_LOCATION}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_TRUSTSTORE_PASSWORD="${MICRO_IDENTITY_EJBCA_TRUSTSTORE_PASSWORD}"
export SPRING_SSL_BUNDLE_JKS_EJBCA_TRUSTSTORE_TYPE="${MICRO_IDENTITY_EJBCA_TRUSTSTORE_TYPE}"

mvnd -f simpl-repo/identity-provider/ -Dmaven.test.skip spring-boot:run -Dspring-boot.run.profiles=local,local-authority "$@"
